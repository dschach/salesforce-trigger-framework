<!doctype html>
<html lang="en">
  <head>
    <title>Salesforce Trigger Handler code documentation</title>
    <meta charset="UTF-8" />
    <script type="module" src="./assets/index.js"></script>
    <script type="module" src="./assets/search-idx.js"></script>
    <script type="module" src="./assets/search.js"></script>
    <script charset="UTF-8" src="./assets/highlight.js"></script>
    <script charset="UTF-8" src="./assets/mark.js"></script>
    <script charset="UTF-8" src="./assets/lunr.js"></script>
    <link rel="stylesheet" href="./assets/highlight.css" />
    <link rel="stylesheet" type="text/css" href="./assets/index.css" />
    <link rel="shortcut icon" type="image/png" href="./assets/favicon.png" />
  </head>

  <body>
    <div id="side-bar">
      <div id="logo-container">
        <div class="title">Salesforce Trigger Handler code documentation</div>
        <img src="assets/logo.png" />
        <div class="subtitle">
          Documentation for <a target="_blank" rel="noopener noreferrer" href="https://github.com/dschach/salesforce-trigger-framework">Trigger Framework</a>
        </div>
      </div>
      <div id="search-wrapper">
        <div class="search-icon"></div>
        <input id="search-input" type="text" autocomplete="off" placeholder="Search..." />
      </div>
      <ul id="search-results" class=""></ul>
      <div class="navbar">
        <nav role="navigation">
          <a class="nav-header" id="home" href="javascript:void(0)" onclick="goToLocation('index.html');"> Home </a>
          <details id="SampleTriggerHandler" class="group-name">
            <summary id="header-SampleTriggerHandler" class="nav-header">
              <a href="javascript:void(0)" title="See Class Group info" onclick="goToLocation('sampletriggerhandlerhome.html');">SampleTriggerHandler</a>
            </summary>
            <ul>
              <!-- menu items -->
              <li
                title="AccountSampleMetadataTriggerHandler"
                id="item-AccountSampleMetadataTriggerHandler"
                class="nav-item class public"
                onclick="goToLocation('AccountSampleMetadataTriggerHandler.html');">
                <a tabindex="1" href="javascript:void(0)">AccountSampleMetadataTriggerHandler</a>
              </li>
              <li
                title="AccountSampleMetadataTriggerHandlerTest"
                id="item-AccountSampleMetadataTriggerHandlerTest"
                class="nav-item class public"
                onclick="goToLocation('AccountSampleMetadataTriggerHandlerTest.html');">
                <a tabindex="1" href="javascript:void(0)">AccountSampleMetadataTriggerHandlerTest</a>
              </li>
              <li
                title="AccountSampleTriggerHandler"
                id="item-AccountSampleTriggerHandler"
                class="nav-item class public"
                onclick="goToLocation('AccountSampleTriggerHandler.html');">
                <a tabindex="1" href="javascript:void(0)">AccountSampleTriggerHandler</a>
              </li>
              <li
                title="AccountSampleTriggerHandlerTest"
                id="item-AccountSampleTriggerHandlerTest"
                class="nav-item class private"
                onclick="goToLocation('AccountSampleTriggerHandlerTest.html');">
                <a tabindex="1" href="javascript:void(0)">AccountSampleTriggerHandlerTest</a>
              </li>
            </ul>
          </details>
          <details id="Trigger_Handler" class="group-name">
            <summary id="header-Trigger_Handler" class="nav-header">
              <span>Trigger Handler</span>
            </summary>
            <ul>
              <!-- menu items -->
              <li title="TriggerHandler" id="item-TriggerHandler" class="nav-item class public" onclick="goToLocation('TriggerHandler.html');">
                <a tabindex="1" href="javascript:void(0)">TriggerHandler</a>
              </li>
              <li title="TriggerHandlerTest" id="item-TriggerHandlerTest" class="nav-item class private" onclick="goToLocation('TriggerHandlerTest.html');">
                <a tabindex="1" href="javascript:void(0)">TriggerHandlerTest</a>
              </li>
              <li title="MetadataTriggerHandler" id="item-MetadataTriggerHandler" class="nav-item class public" onclick="goToLocation('MetadataTriggerHandler.html');">
                <a tabindex="1" href="javascript:void(0)">MetadataTriggerHandler</a>
              </li>
            </ul>
          </details>
        </nav>
      </div>
    </div>
    <table id="content">
      <tr>
        <td class="scoping-panel">
          Show: <input type="checkbox" checked="true" id="cbx-all" onclick="toggleAllScopes(this.checked);" /> <label for="cbx-all">All</label>&nbsp;&nbsp;
          <input type="checkbox" checked="true" id="cbx-public" onclick="toggleScope('public', this.checked);" />
          <label for="cbx-public"> public </label>&nbsp;&nbsp;<input type="checkbox" checked="true" id="cbx-private" onclick="toggleScope('private', this.checked);" />
          <label for="cbx-private"> private </label>&nbsp;&nbsp;<input type="checkbox" checked="true" id="cbx-protected" onclick="toggleScope('protected', this.checked);" />
          <label for="cbx-protected"> protected </label>&nbsp;&nbsp;<input type="checkbox" checked="true" id="cbx-testmethod" onclick="toggleScope('testmethod', this.checked);" />
          <label for="cbx-testmethod"> testMethod </label>
        </td>
      </tr>
      <tr>
        <td class="doc-page">
          <h2 class="section-title">Home</h2>
          <link href="assets/styling.css" rel="stylesheet" />
          <p>
            <a href="https://codecov.io/gh/dschach/salesforce-trigger-framework"
              ><img src="https://codecov.io/gh/dschach/salesforce-trigger-framework/branch/main/graph/badge.svg?token=1StpM73gpE" alt="codecov"
            /></a>
            <a href="https://github.com/dschach/salesforce-trigger-framework/actions/workflows/ci.yml"
              ><img src="https://github.com/dschach/salesforce-trigger-framework/actions/workflows/ci.yml/badge.svg?branch=main&event=push" alt="CI"
            /></a>
            <a href="https://img.shields.io/twitter/follow/dschach.svg?style=social"><img src="https://img.shields.io/twitter/follow/dschach.svg?style=social" alt="Twitter" /></a>
          </p>
          <h1>Salesforce Trigger Framework</h1>
          <ul>
            <li>
              <a href="#salesforce-trigger-framework">Salesforce Trigger Framework</a>
              <ul>
                <li><a href="#credit">Credit</a></li>
                <li>
                  <a href="#documentation">Documentation</a>
                  <ul>
                    <li><a href="#changelog">Changelog</a></li>
                  </ul>
                </li>
                <li><a href="#overview">Overview</a></li>
                <li>
                  <a href="#usage">Usage</a>
                  <ul>
                    <li><a href="#trigger-handler">Trigger Handler</a></li>
                    <li><a href="#trigger">Trigger</a></li>
                  </ul>
                </li>
                <li>
                  <a href="#cool-stuff">Cool Stuff</a>
                  <ul>
                    <li><a href="#bypass-api">Bypass API</a></li>
                    <li><a href="#check-bypass-status">Check Bypass Status</a></li>
                    <li><a href="#global-bypass">Global Bypass</a></li>
                    <li><a href="#set-bypass">Set Bypass</a></li>
                    <li><a href="#max-loop-count">Max Loop Count</a></li>
                    <li><a href="#debug-statements">Debug Statements</a></li>
                    <li><a href="#universal-action">Universal Action</a></li>
                  </ul>
                </li>
                <li><a href="#overridable-methods">Overridable Methods</a></li>
              </ul>
            </li>
          </ul>
          <h2>Credit</h2>
          <p>Based on Kevin O&#39;Hara&#39;s famous framework <a href="https://github.com/kevinohara80/sfdc-trigger-framework">sfdc-trigger-framework</a></p>
          <h2>Documentation</h2>
          <p><a href="https://dschach.github.io/salesforce-trigger-framework/TriggerHandler.html">Class Documentation</a></p>
          <h3>Changelog</h3>
          <p><a href="changelog.html">Complete Changelog</a></p>
          <h2>Overview</h2>
          <p>(from Kevin O&#39;Hara)</p>
          <p>
            Triggers should (IMO) be logicless. Putting logic into your triggers creates un-testable, difficult-to-maintain code. It&#39;s widely accepted that a best-practice is
            to move trigger logic into a handler class.
          </p>
          <p>
            This trigger framework bundles a single <strong>TriggerHandler</strong> base class that you can inherit from in all of your trigger handlers. The base class includes
            context-specific methods that are automatically called when a trigger is executed.
          </p>
          <p>
            The base class also provides a secondary role as a supervisor for Trigger execution. It acts like a watchdog, monitoring trigger activity and providing an api for
            controlling certain aspects of execution and control flow.
          </p>
          <p>But the most important part of this framework is that it&#39;s minimal and simple to use.</p>
          <p><strong>Deploy to SFDX Scratch Org:</strong> <a href="./deploy.html">Deploy instructions</a></p>
          <p>
            <strong>Deploy to Salesforce Org:</strong>
            <a href="https://githubsfdeploy.herokuapp.com/?owner=dschach&repo=salesforce-trigger-framework"
              ><img src="https://raw.githubusercontent.com/afawcett/githubsfdeploy/master/deploy.png" alt="Deploy"
            /></a>
          </p>
          <h2>Usage</h2>
          <h3>Trigger Handler</h3>
          <p>
            To create a trigger handler, you simply need to create a class that inherits from
            <a href="https://github.com/dschach/salesforce-trigger-framework/blob/main/sfdx-source/main/default/classes/TriggerHandler.cls">TriggerHandler.cls</a>. Here is an
            example for creating an Opportunity trigger handler.
          </p>
          <pre><code class="language-apex">public class OpportunityTriggerHandler extends TriggerHandler {
</code></pre>
          <p>
            In your trigger handler, to add logic to any of the trigger contexts, you only need to override them in your trigger handler. Here is how we would add logic to a
            <code>beforeUpdate, afterUpdate</code> trigger.
          </p>
          <p>
            A sample <a href="https://github.com/dschach/salesforce-trigger-framework/tree/main/sample-handler/main/default/classes">AccountSampleTriggerHandler</a> class has been
            included in this repository, as well as a sample
            <a href="https://github.com/dschach/salesforce-trigger-framework/blob/main/sample-handler/main/default/triggers/AccountSampleTrigger.trigger">trigger</a>.
          </p>
          <p>
            <strong>Note:</strong> When referencing the Trigger static maps within a class, SObjects are returned versus SObject subclasses like Opportunity, Account, etc. This
            means that you must cast when you reference them in your trigger handler. You could do this in your constructor if you wanted. Technically, you only need to cast for
            oldMap and newMap, but for completeness, I encourage casting Trigger.new and Trigger.old as well.
          </p>
          <pre><code class="language-apex">public class OpportunityTriggerHandler extends TriggerHandler {
  private List&lt;Opportunity&gt; newRecords;
  private List&lt;Opportunity&gt; oldRecords;
  private Map&lt;Id, Opportunity&gt; newRecordsMap;
  private Map&lt;Id, Opportunity&gt; oldRecordsMap;

  public OpportunityTriggerHandler(){
    super(&#39;OpportunityTriggerHandler&#39;);
    this.newRecords = Trigger.new;
    this.oldRecords = Trigger.old;
    this.newRecordsMap = (Map&lt;Id, Opportunity&gt;) Trigger.newMap;
    this.oldRecordsMap = (Map&lt;Id, Opportunity&gt;) Trigger.oldMap;
  }

  public override void beforeUpdate() {
    for(Opportunity o : newRecords) {
      /* do something */
    }
  }

  public override void afterUpdate() {
      /* do something */
  }

  /* add overrides for other contexts */

}
</code></pre>
          <h3>Trigger</h3>
          <p>
            To use the trigger handler, you only need to construct an instance of your trigger handler within the trigger handler itself and call the <code>run()</code> method.
            Here is an example of an Opportunity trigger.
          </p>
          <p>
            This is the way to write a trigger that will run the trigger handlers below. Note that some objects do not work in every context, so ensure that you list only
            applicable trigger contexts in your trigger definition and that you only override those contexts. If you include extra contexts, they will not be covered by Apex tests,
            which could lead to deployment problems.
          </p>
          <pre><code class="language-apex">trigger OpportunityTrigger on Opportunity (before update, after update) {
  new OpportunityTriggerHandler().run();
}
</code></pre>
          <p>
            There is also a faster way to write the trigger, specifying the handler class name so the handler does not need to describe the class for its name, saving precious
            execution time:
          </p>
          <pre><code class="language-apex">trigger OpportunityTrigger on Opportunity (before update, after update) {
  new OpportunityTriggerHandler(&#39;OpportunityTriggerHandler&#39;).run();
}
</code></pre>
          <h2>Cool Stuff</h2>
          <h3>Bypass API</h3>
          <p>What if you want to tell other trigger handlers to halt execution? That&#39;s easy with the bypass api:</p>
          <pre><code class="language-apex">public class OpportunityTriggerHandler extends TriggerHandler {
  private Map&lt;Id, Opportunity&gt; newRecordsMap;

  /* Optional Constructor - better performance */
  public OpportunityTriggerHandler(){
    super(&#39;OpportunityTriggerHandler&#39;);
    this.newRecordsMap = (Map&lt;Id, Opportunity&gt;) Trigger.newMap;
  }

  public override void afterUpdate() {
    List&lt;Opportunity&gt; opps = [SELECT Id, AccountId FROM Opportunity WHERE Id IN :newRecordsMap.keySet()];

    Account acc = [SELECT Id, Name FROM Account WHERE Id = :opps.get(0).AccountId];

    TriggerHandler.bypass(&#39;AccountTriggerHandler&#39;);

    acc.Name = &#39;No Trigger&#39;;
    update acc; /* won&#39;t invoke the AccountTriggerHandler */

    TriggerHandler.clearBypass(&#39;AccountTriggerHandler&#39;);

    acc.Name = &#39;With Trigger&#39;;
    update acc; /* will invoke the AccountTriggerHandler */
  }

}
</code></pre>
          <h3>Check Bypass Status</h3>
          <p>If you need to check if a handler is bypassed, use the <code>isBypassed</code> method:</p>
          <pre><code class="language-apex">if (TriggerHandler.isBypassed(&#39;AccountTriggerHandler&#39;)) {
  /* ... do something if the Account trigger handler is bypassed! */
}
</code></pre>
          <h3>Global Bypass</h3>
          <p>To bypass all handlers, set the global bypass variable:</p>
          <pre><code class="language-apex">TriggerHandler.setGlobalBypass();
</code></pre>
          <p>This will also add an entry &#39;bypassAll&#39; to the list of handlers returned in <code>bypassList</code>.</p>
          <p>To clear all bypasses for the transaction, simply use the <code>clearAllBypasses</code> method, as in:</p>
          <pre><code class="language-apex">/* ... done with bypasses! */

TriggerHandler.clearAllBypasses();

/* ... now handlers won&#39;t be ignored! */
</code></pre>
          <p>This will clear the list of bypassed handlers and set the <code>globalBypass</code> Boolean to false.</p>
          <h3>Set Bypass</h3>
          <p>
            If you are not sure in a transaction if a handler is bypassed, but want to bypass it (or clear the bypass) and then set it to its original value, use the
            <code>setBybass</code> method:
          </p>
          <pre><code class="language-apex">Boolean isBypassed = TriggerHandler.isBypassed(&#39;AccountTriggerHandler&#39;);
TriggerHandler.bypass(&#39;AccountTriggerHandler&#39;);

/* do something here */

TriggerHandler.setBypass(&#39;AccountTriggerHandler&#39;, isBypassed);
</code></pre>
          <p>To store all currently bypassed handlers, temporarily bypass all handlers, and then restore the originally bypassed list:</p>
          <pre><code class="language-apex">List&lt;String&gt; bypassedHandlers = TriggerHandler.bypassList();
TriggerHandler.bypassAll();

/* do something here */

TriggerHandler.clearAllBypasses();
TriggerHandler.bypass(bypassedHandlers);
</code></pre>
          <h3>Max Loop Count</h3>
          <p>
            To prevent recursion, you can set a max loop count for Trigger Handler. If this max is exceeded, the trigger will silently stop running. If <code>showDebug()</code> has
            been included, a statement that the max loop count has been reached will be sent to the debug log. A great use case is when you want to ensure that your trigger runs
            once and only once within a single execution.
          </p>
          <pre><code class="language-apex">public class OpportunityTriggerHandler extends TriggerHandler {
  private Map&lt;Id, Opportunity&gt; newRecordsMap;

  public OpportunityTriggerHandler(){
    /* Optional Constructor overload - better performance */
    super(&#39;OpportunityTriggerHandler&#39;);
    this.newRecordsMap = (Map&lt;Id, Opportunity&gt;) Trigger.newMap;
    this.setMaxLoopCount(1);
  }

  public override void afterUpdate() {
    List&lt;Opportunity&gt; opps = [SELECT Id FROM Opportunity WHERE Id IN :newRecordsMap.keySet()];
    update opps;
  }
}
</code></pre>
          <p>In version 1.2, the ability to chain methods was added. Now, you can set the max loop count in a single line in your trigger:</p>
          <pre><code class="language-apex">trigger OpportunityTrigger on Opportunity (before update, after update) {
  new OpportunityTriggerHandler().setMaxLoopCount(5).run();
}
</code></pre>
          <h3>Debug Statements</h3>
          <p>There are two methods that will show additional information.</p>
          <p><code>TriggerHandler.showLimits()</code> will debug Apex query and DML limits when the trigger handler has completed.</p>
          <p><code>TriggerHandler.showDebug()</code> will show trigger entry and exit in debug logs. Use sparingly, as it will decrease org performance.</p>
          <p>To use one or both of these, either add them to the <em>trigger</em> (note that you can specify for ALL handlers or for a specific handler)</p>
          <pre><code class="language-apex">TriggerHandler.showLimits();
AccountTriggerHandler.showDebug();
new AccountSampleTriggerHandler().run();
TriggerHandler.showLimits(false);
AccountTriggerHandler.showDebug(false);
</code></pre>
          <p>or put them in your Apex <em>trigger handler</em> code before and after DML statements.</p>
          <pre><code class="language-apex">LeadTriggerHandler.showLimits();
TriggerHandler.showDebug();

update leadsList;

LeadTriggerHandler.showLimits(false);
TriggerHandler.showDebug(false);
</code></pre>
          <p>
            In version 1.2, the ability to chain methods <em>in triggers</em> was added. Now, you can specify showing debug messages and limits in a single line in your trigger:
          </p>
          <pre><code class="language-apex">trigger OpportunityTrigger on Opportunity (before update, after update) {
  new OpportunityTriggerHandler().debug().limits().run(); // debug() is the same as debug(true)
}
</code></pre>
          <p>Or stop showing them.</p>
          <pre><code class="language-apex">trigger OpportunityTrigger on Opportunity (before update, after update) {
  new OpportunityTriggerHandler().debug(false).limits(false).run();
}
</code></pre>
          <h3>Universal Action</h3>
          <p>
            Version 1.1 added a new method/context: <code>andFinally()</code> can contain actions that should happen in every trigger context, after all other actions. Credit to
            James Simone for this idea. As he writes, &quot;runs after every context - can be used to easily implement something like apex-rollup!&quot; (<a
              href="https://www.jamessimone.net/blog/joys-of-apex/lightweight-trigger-handler/"
              >The Joys of Apex</a
            >)
          </p>
          <h2>Overridable Methods</h2>
          <p>Here are all of the methods that you can override. All of the context possibilities are supported.</p>
          <ul>
            <li><code>beforeInsert()</code></li>
            <li><code>beforeUpdate()</code></li>
            <li><code>beforeDelete()</code></li>
            <li><code>afterInsert()</code></li>
            <li><code>afterUpdate()</code></li>
            <li><code>afterDelete()</code></li>
            <li><code>afterUndelete()</code></li>
            <li><code>andFinally()</code></li>
          </ul>
        </td>
      </tr>
      <tr>
        <td class="footer">
          <div>
            <a href="https://github.com/no-stack-dub-sack/apexdox-vs-code" target="_blank" rel="noopener noreferrer"> Powered By ApexDox VS Code </a>
          </div>
        </td>
      </tr>
    </table>
  </body>
</html>
